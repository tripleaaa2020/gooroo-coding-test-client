{"ast":null,"code":"var tty = require('tty');\n\nvar encode = require('./lib/encode');\n\nvar Stream = require('stream').Stream;\n\nvar exports = module.exports = function () {\n  var input = null;\n\n  function setInput(s) {\n    if (input) throw new Error('multiple inputs specified');else input = s;\n  }\n\n  var output = null;\n\n  function setOutput(s) {\n    if (output) throw new Error('multiple outputs specified');else output = s;\n  }\n\n  for (var i = 0; i < arguments.length; i++) {\n    var arg = arguments[i];\n    if (!arg) continue;\n    if (arg.readable) setInput(arg);else if (arg.stdin || arg.input) setInput(arg.stdin || arg.input);\n    if (arg.writable) setOutput(arg);else if (arg.stdout || arg.output) setOutput(arg.stdout || arg.output);\n  }\n\n  if (input && typeof input.fd === 'number' && tty.isatty(input.fd)) {\n    if (process.stdin.setRawMode) {\n      process.stdin.setRawMode(true);\n    } else tty.setRawMode(true);\n  }\n\n  var charm = new Charm();\n\n  if (input) {\n    input.pipe(charm);\n  }\n\n  if (output) {\n    charm.pipe(output);\n  }\n\n  charm.once('^C', process.exit);\n  charm.once('end', function () {\n    if (input) {\n      if (typeof input.fd === 'number' && tty.isatty(input.fd)) {\n        if (process.stdin.setRawMode) {\n          process.stdin.setRawMode(false);\n        } else tty.setRawMode(false);\n      }\n\n      input.destroy();\n    }\n  });\n  return charm;\n};\n\nvar Charm = exports.Charm = function Charm() {\n  this.writable = true;\n  this.readable = true;\n  this.pending = [];\n};\n\nCharm.prototype = new Stream();\n\nCharm.prototype.write = function (buf) {\n  var self = this;\n\n  if (self.pending.length) {\n    var codes = extractCodes(buf);\n    var matched = false;\n\n    for (var i = 0; i < codes.length; i++) {\n      for (var j = 0; j < self.pending.length; j++) {\n        var cb = self.pending[j];\n\n        if (cb(codes[i])) {\n          matched = true;\n          self.pending.splice(j, 1);\n          break;\n        }\n      }\n    }\n\n    if (matched) return;\n  }\n\n  if (buf.length === 1) {\n    if (buf[0] === 3) self.emit('^C');\n    if (buf[0] === 4) self.emit('^D');\n  }\n\n  self.emit('data', buf);\n  return self;\n};\n\nCharm.prototype.destroy = function () {\n  this.end();\n};\n\nCharm.prototype.end = function (buf) {\n  if (buf) this.write(buf);\n  this.emit('end');\n};\n\nCharm.prototype.reset = function (cb) {\n  this.write(encode('c'));\n  return this;\n};\n\nCharm.prototype.position = function (x, y) {\n  // get/set absolute coordinates\n  if (typeof x === 'function') {\n    var cb = x;\n    this.pending.push(function (buf) {\n      if (buf[0] === 27 && buf[1] === encode.ord('[') && buf[buf.length - 1] === encode.ord('R')) {\n        var pos = buf.toString().slice(2, -1).split(';').map(Number);\n        cb(pos[1], pos[0]);\n        return true;\n      }\n    });\n    this.write(encode('[6n'));\n  } else {\n    this.write(encode('[' + Math.floor(y) + ';' + Math.floor(x) + 'f'));\n  }\n\n  return this;\n};\n\nCharm.prototype.move = function (x, y) {\n  // set relative coordinates\n  var bufs = [];\n  if (y < 0) this.up(-y);else if (y > 0) this.down(y);\n  if (x > 0) this.right(x);else if (x < 0) this.left(-x);\n  return this;\n};\n\nCharm.prototype.up = function (y) {\n  if (y === undefined) y = 1;\n  this.write(encode('[' + Math.floor(y) + 'A'));\n  return this;\n};\n\nCharm.prototype.down = function (y) {\n  if (y === undefined) y = 1;\n  this.write(encode('[' + Math.floor(y) + 'B'));\n  return this;\n};\n\nCharm.prototype.right = function (x) {\n  if (x === undefined) x = 1;\n  this.write(encode('[' + Math.floor(x) + 'C'));\n  return this;\n};\n\nCharm.prototype.left = function (x) {\n  if (x === undefined) x = 1;\n  this.write(encode('[' + Math.floor(x) + 'D'));\n  return this;\n};\n\nCharm.prototype.column = function (x) {\n  this.write(encode('[' + Math.floor(x) + 'G'));\n  return this;\n};\n\nCharm.prototype.push = function (withAttributes) {\n  this.write(encode(withAttributes ? '7' : '[s'));\n  return this;\n};\n\nCharm.prototype.pop = function (withAttributes) {\n  this.write(encode(withAttributes ? '8' : '[u'));\n  return this;\n};\n\nCharm.prototype.erase = function (s) {\n  if (s === 'end' || s === '$') {\n    this.write(encode('[K'));\n  } else if (s === 'start' || s === '^') {\n    this.write(encode('[1K'));\n  } else if (s === 'line') {\n    this.write(encode('[2K'));\n  } else if (s === 'down') {\n    this.write(encode('[J'));\n  } else if (s === 'up') {\n    this.write(encode('[1J'));\n  } else if (s === 'screen') {\n    this.write(encode('[1J'));\n  } else {\n    this.emit('error', new Error('Unknown erase type: ' + s));\n  }\n\n  return this;\n};\n\nCharm.prototype.display = function (attr) {\n  var c = {\n    reset: 0,\n    bright: 1,\n    dim: 2,\n    underscore: 4,\n    blink: 5,\n    reverse: 7,\n    hidden: 8\n  }[attr];\n\n  if (c === undefined) {\n    this.emit('error', new Error('Unknown attribute: ' + attr));\n  }\n\n  this.write(encode('[' + c + 'm'));\n  return this;\n};\n\nCharm.prototype.foreground = function (color) {\n  if (typeof color === 'number') {\n    if (color < 0 || color >= 256) {\n      this.emit('error', new Error('Color out of range: ' + color));\n    }\n\n    this.write(encode('[38;5;' + color + 'm'));\n  } else {\n    var c = {\n      black: 30,\n      red: 31,\n      green: 32,\n      yellow: 33,\n      blue: 34,\n      magenta: 35,\n      cyan: 36,\n      white: 37\n    }[color.toLowerCase()];\n    if (!c) this.emit('error', new Error('Unknown color: ' + color));\n    this.write(encode('[' + c + 'm'));\n  }\n\n  return this;\n};\n\nCharm.prototype.background = function (color) {\n  if (typeof color === 'number') {\n    if (color < 0 || color >= 256) {\n      this.emit('error', new Error('Color out of range: ' + color));\n    }\n\n    this.write(encode('[48;5;' + color + 'm'));\n  } else {\n    var c = {\n      black: 40,\n      red: 41,\n      green: 42,\n      yellow: 43,\n      blue: 44,\n      magenta: 45,\n      cyan: 46,\n      white: 47\n    }[color.toLowerCase()];\n    if (!c) this.emit('error', new Error('Unknown color: ' + color));\n    this.write(encode('[' + c + 'm'));\n  }\n\n  return this;\n};\n\nCharm.prototype.cursor = function (visible) {\n  this.write(encode(visible ? '[?25h' : '[?25l'));\n  return this;\n};\n\nvar extractCodes = exports.extractCodes = function (buf) {\n  var codes = [];\n  var start = -1;\n\n  for (var i = 0; i < buf.length; i++) {\n    if (buf[i] === 27) {\n      if (start >= 0) codes.push(buf.slice(start, i));\n      start = i;\n    } else if (start >= 0 && i === buf.length - 1) {\n      codes.push(buf.slice(start));\n    }\n  }\n\n  return codes;\n};","map":{"version":3,"sources":["/Users/mac/react/gooroo-code-test/bigas-library-client/node_modules/charm/index.js"],"names":["tty","require","encode","Stream","exports","module","input","setInput","s","Error","output","setOutput","i","arguments","length","arg","readable","stdin","writable","stdout","fd","isatty","process","setRawMode","charm","Charm","pipe","once","exit","destroy","pending","prototype","write","buf","self","codes","extractCodes","matched","j","cb","splice","emit","end","reset","position","x","y","push","ord","pos","toString","slice","split","map","Number","Math","floor","move","bufs","up","down","right","left","undefined","column","withAttributes","pop","erase","display","attr","c","bright","dim","underscore","blink","reverse","hidden","foreground","color","black","red","green","yellow","blue","magenta","cyan","white","toLowerCase","background","cursor","visible","start"],"mappings":"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","sourcesContent":["var tty = require('tty');\nvar encode = require('./lib/encode');\nvar Stream = require('stream').Stream;\n\nvar exports = module.exports = function () {\n    var input = null;\n    function setInput (s) {\n        if (input) throw new Error('multiple inputs specified')\n        else input = s\n    }\n    \n    var output = null;\n    function setOutput (s) {\n        if (output) throw new Error('multiple outputs specified')\n        else output = s\n    }\n    \n    for (var i = 0; i < arguments.length; i++) {\n        var arg = arguments[i];\n        if (!arg) continue;\n        if (arg.readable) setInput(arg)\n        else if (arg.stdin || arg.input) setInput(arg.stdin || arg.input)\n        \n        if (arg.writable) setOutput(arg)\n        else if (arg.stdout || arg.output) setOutput(arg.stdout || arg.output)\n        \n    }\n    \n    if (input && typeof input.fd === 'number' && tty.isatty(input.fd)) {\n        if (process.stdin.setRawMode) {\n            process.stdin.setRawMode(true);\n        }\n        else tty.setRawMode(true);\n    }\n    \n    var charm = new Charm;\n    if (input) {\n        input.pipe(charm);\n    }\n    \n    if (output) {\n        charm.pipe(output);\n    }\n    \n    charm.once('^C', process.exit);\n    charm.once('end', function () {\n      if (input) {\n          if (typeof input.fd === 'number' && tty.isatty(input.fd)) {\n            if (process.stdin.setRawMode) {\n                process.stdin.setRawMode(false);\n            }\n            else tty.setRawMode(false);\n          }\n          input.destroy();\n      }\n    });\n\n    return charm;\n};\n\nvar Charm = exports.Charm = function Charm () {\n    this.writable = true;\n    this.readable = true;\n    this.pending = [];\n}\n\nCharm.prototype = new Stream;\n\nCharm.prototype.write = function (buf) {\n    var self = this;\n    \n    if (self.pending.length) {\n        var codes = extractCodes(buf);\n        var matched = false;\n        \n        for (var i = 0; i < codes.length; i++) {\n            for (var j = 0; j < self.pending.length; j++) {\n                var cb = self.pending[j];\n                if (cb(codes[i])) {\n                    matched = true;\n                    self.pending.splice(j, 1);\n                    break;\n                }\n            }\n        }\n        \n        if (matched) return;\n    }\n    \n    if (buf.length === 1) {\n        if (buf[0] === 3) self.emit('^C');\n        if (buf[0] === 4) self.emit('^D');\n    }\n    \n    self.emit('data', buf);\n    \n    return self;\n};\n\n\nCharm.prototype.destroy = function () {\n    this.end();\n};\n\nCharm.prototype.end = function (buf) {\n    if (buf) this.write(buf);\n    this.emit('end');\n};\n\nCharm.prototype.reset = function (cb) {\n    this.write(encode('c'));\n    return this;\n};\n\nCharm.prototype.position = function (x, y) {\n    // get/set absolute coordinates\n    if (typeof x === 'function') {\n        var cb = x;\n        this.pending.push(function (buf) {\n            if (buf[0] === 27 && buf[1] === encode.ord('[')\n            && buf[buf.length-1] === encode.ord('R')) {\n                var pos = buf.toString()\n                    .slice(2,-1)\n                    .split(';')\n                    .map(Number)\n                ;\n                cb(pos[1], pos[0]);\n                return true;\n            }\n        });\n        this.write(encode('[6n'));\n    }\n    else {\n        this.write(encode(\n            '[' + Math.floor(y) + ';' + Math.floor(x) + 'f'\n        ));\n    }\n    return this;\n};\n\nCharm.prototype.move = function (x, y) {\n    // set relative coordinates\n    var bufs = [];\n    \n    if (y < 0) this.up(-y)\n    else if (y > 0) this.down(y)\n    \n    if (x > 0) this.right(x)\n    else if (x < 0) this.left(-x)\n    \n    return this;\n};\n\nCharm.prototype.up = function (y) {\n    if (y === undefined) y = 1;\n    this.write(encode('[' + Math.floor(y) + 'A'));\n    return this;\n};\n\nCharm.prototype.down = function (y) {\n    if (y === undefined) y = 1;\n    this.write(encode('[' + Math.floor(y) + 'B'));\n    return this;\n};\n\nCharm.prototype.right = function (x) {\n    if (x === undefined) x = 1;\n    this.write(encode('[' + Math.floor(x) + 'C'));\n    return this;\n};\n\nCharm.prototype.left = function (x) {\n    if (x === undefined) x = 1;\n    this.write(encode('[' + Math.floor(x) + 'D'));\n    return this;\n};\n\nCharm.prototype.column = function (x) {\n    this.write(encode('[' + Math.floor(x) + 'G'));\n    return this;\n};\n\nCharm.prototype.push = function (withAttributes) {\n    this.write(encode(withAttributes ? '7' : '[s'));\n    return this;\n};\n\nCharm.prototype.pop = function (withAttributes) {\n    this.write(encode(withAttributes ? '8' : '[u'));\n    return this;\n};\n\nCharm.prototype.erase = function (s) {\n    if (s === 'end' || s === '$') {\n        this.write(encode('[K'));\n    }\n    else if (s === 'start' || s === '^') {\n        this.write(encode('[1K'));\n    }\n    else if (s === 'line') {\n        this.write(encode('[2K'));\n    }\n    else if (s === 'down') {\n        this.write(encode('[J'));\n    }\n    else if (s === 'up') {\n        this.write(encode('[1J'));\n    }\n    else if (s === 'screen') {\n        this.write(encode('[1J'));\n    }\n    else {\n        this.emit('error', new Error('Unknown erase type: ' + s));\n    }\n    return this;\n};\n\nCharm.prototype.display = function (attr) {\n    var c = {\n        reset : 0,\n        bright : 1,\n        dim : 2,\n        underscore : 4,\n        blink : 5,\n        reverse : 7,\n        hidden : 8\n    }[attr];\n    if (c === undefined) {\n        this.emit('error', new Error('Unknown attribute: ' + attr));\n    }\n    this.write(encode('[' + c + 'm'));\n    return this;\n};\n\nCharm.prototype.foreground = function (color) {\n    if (typeof color === 'number') {\n        if (color < 0 || color >= 256) {\n            this.emit('error', new Error('Color out of range: ' + color));\n        }\n        this.write(encode('[38;5;' + color + 'm'));\n    }\n    else {\n        var c = {\n            black : 30,\n            red : 31,\n            green : 32,\n            yellow : 33,\n            blue : 34,\n            magenta : 35,\n            cyan : 36,\n            white : 37\n        }[color.toLowerCase()];\n        \n        if (!c) this.emit('error', new Error('Unknown color: ' + color));\n        this.write(encode('[' + c + 'm'));\n    }\n    return this;\n};\n\nCharm.prototype.background = function (color) {\n    if (typeof color === 'number') {\n        if (color < 0 || color >= 256) {\n            this.emit('error', new Error('Color out of range: ' + color));\n        }\n        this.write(encode('[48;5;' + color + 'm'));\n    }\n    else {\n        var c = {\n          black : 40,\n          red : 41,\n          green : 42,\n          yellow : 43,\n          blue : 44,\n          magenta : 45,\n          cyan : 46,\n          white : 47\n        }[color.toLowerCase()];\n        \n        if (!c) this.emit('error', new Error('Unknown color: ' + color));\n        this.write(encode('[' + c + 'm'));\n    }\n    return this;\n};\n\nCharm.prototype.cursor = function (visible) {\n    this.write(encode(visible ? '[?25h' : '[?25l'));\n    return this;\n};\n\nvar extractCodes = exports.extractCodes = function (buf) {\n    var codes = [];\n    var start = -1;\n    \n    for (var i = 0; i < buf.length; i++) {\n        if (buf[i] === 27) {\n            if (start >= 0) codes.push(buf.slice(start, i));\n            start = i;\n        }\n        else if (start >= 0 && i === buf.length - 1) {\n            codes.push(buf.slice(start));\n        }\n    }\n    \n    return codes;\n}\n"]},"metadata":{},"sourceType":"script"}